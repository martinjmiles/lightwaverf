      <html>
        <head>
          <title>Lightwaverf energy stats 2016-01-14 13:45:03 +0000</title>
          <style type="text/css">
            body { font-family: arial, verdana, sans-serif; }
            div#energy_chart { width: 800px; height: 600px; }
            dd { display: none; }
            .off, .on:hover { padding-right: 18px; background: url(lightning_delete.png) no-repeat top right; }
            .on, .off:hover { padding-right: 18px; background: url(lightning_add.png) no-repeat top right; }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="row">
              <div class="col">
                <h1>Lightwaverf energy stats</h1>
                <p class="intro">Sample page generated with <code>lightwaverf web</code>.
      Check out <a href="https://github.com/pauly/lightwaverf">the new simplified repo</a> for details
      or <a href="https://rubygems.org/gems/lightwaverf">gem install lightwaverf && lightwaverf web</a>...
      <br />@todo merge this with <a href="https://github.com/pauly/robot-butler">robot butler</a>...
</p>
                <div id="energy_chart">
                  Not seeing an energy chart here?
                  Maybe not working in your device yet, sorry.
                  Try in a web browser.
                </div>
                <h2>Rooms and devices</h2>
                <p>@todo make these links to control the devices...</p>
                <p class="help"><dl><dt><a>our</a></dt><dd><ul><li><a class="ajax off" href="/room/our/light">our light</a></li><li><a class="ajax off" href="/room/our/lights">our lights</a></li><li><a class="ajax off" href="/room/our/kettle">our kettle</a></li><li><a class="ajax off" href="/room/our/tv">our tv</a></li></ul></dd></dl></p>
                <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>
  google.charts.load('current', { packages: ['annotationchart'] });
  google.charts.setOnLoadCallback(function() {
    var energy_data = new google.visualization.DataTable();
    energy_data.addColumn('date', 'Date');
    energy_data.addColumn('number', 'Electricity used');
    energy_data.addColumn('string', 'title1');
    energy_data.addColumn('string', 'text1');
    var rawData = [
  [
    1452767943,
    635,
    'tumble dryer',
    'turned on'
  ],
  [
    1452768003,
    772
  ],
  [
    1452768064,
    773
  ],
  [
    1452768124,
    669
  ],
  [
    1452768184,
    699
  ],
  [
    1452768245,
    728
  ],
  [
    1452768305,
    867
  ],
  [
    1452768426,
    772
  ],
  [
    1452768487,
    750
  ],
  [
    1452768547,
    729
  ],
  [
    1452768607,
    799
  ],
  [
    1452768668,
    801
  ],
  [
    1452768728,
    743
  ],
  [
    1452768789,
    743
  ],
  [
    1452768849,
    760
  ],
  [
    1452768909,
    834
  ],
  [
    1452768970,
    845
  ],
  [
    1452769030,
    810
  ],
  [
    1452769091,
    800
  ],
  [
    1452769151,
    793
  ],
  [
    1452769272,
    815
  ],
  [
    1452769393,
    811
  ],
  [
    1452769453,
    810
  ],
  [
    1452769514,
    809
  ],
  [
    1452769574,
    807
  ],
  [
    1452769695,
    807
  ],
  [
    1452769755,
    805
  ],
  [
    1452769816,
    806
  ],
  [
    1452770118,
    791
  ],
  [
    1452770163,
    780
  ],
  [
    1452770223,
    586
  ],
  [
    1452770284,
    408
  ],
  [
    1452770344,
    228
  ],
  [
    1452770405,
    238,
    'tumble dryer',
    'turned off'
  ],
  [
    1452770465,
    247
  ],
  [
    1452770526,
    253
  ],
  [
    1452770586,
    252
  ],
  [
    1452770646,
    251
  ],
  [
    1452770707,
    247
  ],
  [
    1452770828,
    210
  ],
  [
    1452770948,
    174
  ],
  [
    1452771130,
    143
  ],
  [
    1452771190,
    142
  ],
  [
    1452771250,
    143
  ],
  [
    1452771371,
    149
  ],
  [
    1452771492,
    154
  ],
  [
    1452771552,
    159
  ],
  [
    1452771613,
    152
  ],
  [
    1452771673,
    150
  ],
  [
    1452771794,
    148
  ],
  [
    1452771854,
    149
  ],
  [
    1452771915,
    149
  ],
  [
    1452772036,
    149
  ],
  [
    1452772217,
    149
  ],
  [
    1452772262,
    144
  ],
  [
    1452772323,
    144
  ],
  [
    1452772383,
    158
  ],
  [
    1452772443,
    171
  ],
  [
    1452772504,
    179
  ],
  [
    1452772625,
    173
  ],
  [
    1452772806,
    171
  ],
  [
    1452772866,
    169
  ],
  [
    1452772927,
    168
  ],
  [
    1452772987,
    167
  ],
  [
    1452773108,
    162
  ],
  [
    1452773168,
    156
  ],
  [
    1452773229,
    150
  ],
  [
    1452773289,
    152
  ],
  [
    1452773410,
    155
  ],
  [
    1452773470,
    158
  ],
  [
    1452773591,
    158
  ],
  [
    1452773652,
    155
  ],
  [
    1452773772,
    219
  ],
  [
    1452773833,
    219
  ],
  [
    1452773893,
    233,
    'nespresso',
    'cuppa coffee!'
  ],
  [
    1452773954,
    171
  ],
  [
    1452774014,
    172
  ],
  [
    1452774075,
    156
  ],
  [
    1452774135,
    147
  ],
  [
    1452774195,
    178
  ],
  [
    1452774256,
    179
  ],
  [
    1452774316,
    182
  ],
  [
    1452774377,
    147
  ],
  [
    1452774558,
    149
  ],
  [
    1452774603,
    146
  ],
  [
    1452774663,
    145
  ],
  [
    1452774724,
    145
  ],
  [
    1452774784,
    148
  ],
  [
    1452774845,
    148
  ],
  [
    1452774905,
    145
  ],
  [
    1452774965,
    144
  ],
  [
    1452775086,
    149
  ],
  [
    1452775147,
    155
  ],
  [
    1452775207,
    163
  ],
  [
    1452775268,
    164
  ],
  [
    1452775328,
    160
  ],
  [
    1452775509,
    151
  ],
  [
    1452775570,
    144
  ],
  [
    1452775630,
    144
  ],
  [
    1452775690,
    140
  ],
  [
    1452775751,
    138
  ],
  [
    1452775811,
    138
  ],
  [
    1452775872,
    142
  ],
  [
    1452775932,
    143
  ],
  [
    1452775992,
    138
  ],
  [
    1452776053,
    137
  ],
  [
    1452776113,
    138
  ],
  [
    1452776174,
    144
  ],
  [
    1452776234,
    149
  ],
  [
    1452776294,
    153
  ],
  [
    1452776355,
    160
  ],
  [
    1452776536,
    165
  ],
  [
    1452776596,
    169
  ],
  [
    1452776657,
    168
  ],
  [
    1452776717,
    160
  ],
  [
    1452776778,
    154
  ],
  [
    1452776823,
    149
  ],
  [
    1452776944,
    148
  ],
  [
    1452777004,
    149
  ],
  [
    1452777065,
    150
  ],
  [
    1452777125,
    153
  ],
  [
    1452777186,
    156
  ],
  [
    1452777246,
    155
  ],
  [
    1452777306,
    154
  ],
  [
    1452777367,
    150
  ],
  [
    1452777427,
    156
  ],
  [
    1452777488,
    154
  ],
  [
    1452777548,
    156
  ],
  [
    1452777608,
    155
  ],
  [
    1452777669,
    159
  ],
  [
    1452777729,
    162
  ],
  [
    1452777790,
    154
  ],
  [
    1452777850,
    146
  ],
  [
    1452777910,
    137
  ],
  [
    1452777971,
    137
  ],
  [
    1452778031,
    138
  ],
  [
    1452778092,
    137
  ],
  [
    1452778152,
    138
  ],
  [
    1452778212,
    143
  ],
  [
    1452778273,
    152
  ],
  [
    1452778454,
    156
  ],
  [
    1452778515,
    159
  ],
  [
    1452778575,
    161
  ],
  [
    1452778635,
    158
  ],
  [
    1452778696,
    161
  ],
  [
    1452778756,
    156
  ]
];
    // var startDate = rawData[0][0];
    var i = 0;
    energy_data.addRows(rawData.map(function(e) {
      ++ i;
      // if ( e[0] !== startDate ) e[0] += startDate;
      e[0] = new Date( e[0] * 1000 ); // as it is now a timestamp
      // e[1] = e[1] * 10;
      e[2] = e[2] || '';
      e[3] = e[3] || '';
      return e;
    }));
    var chart = new google.visualization.AnnotationChart(document.getElementById('energy_chart'));
    var d = new Date();
    d.setDate(d.getDate() - 1);
    chart.draw(energy_data, { zoomStartTime: d, displayAnnotations: true, title: 'Electricity usage' });
  });
  window.$ && $( function ( ) {
    var key = ''; // @todo prompt for an api key and save it in local storage like https://github.com/pauly/robot-butler does
    $('dt a').click( function ( ) {
      $(this).parent( ).next('dd').slideDown( );
      return false;
    } );
    $('a.ajax').click( function ( ) {
      var $a = $(this);
      var status = $a.data( 'status' ) == 'on' ? 'off' : 'on';
      $.ajax( {
        url: $a.attr('href') + '?status=' + status,
        data: {
          status: status,
          key: key,
        },
        type: 'PUT',
        success: function( js ) {
          $a.data( 'status', status );
          $a.removeClass( status === 'on' ? 'off' : 'on' );
          $a.addClass( status );
          alert( js.result || $a.text( ));
        }
      } );
      return false;
    } );
  } );
</script>

              </div>
            </div>
          </div>
          <p>By <a href="http://www.clarkeology.com/blog/">Paul Clarke</a>, a work in progress.</p>
        </body>
      </html>
